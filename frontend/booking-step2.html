<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카카오맵으로 지역 선택하기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 카카오 지도 API 로드 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=18a27bfefd7b461ecd35f7533947ff19&libraries=services,clusterer,drawing"></script>
    <style>
        #map { width: 100%; height: 500px; border-radius: 0.5rem; }
        .valley-list-item { cursor: pointer; }
        .valley-list-item:hover { background-color: #f0f0f0; }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="container mx-auto max-w-5xl bg-white p-6 rounded-lg shadow-lg">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold">계곡 예약하기</h1>
            <p class="text-gray-600">지도에서 원하시는 지역을 선택하세요.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- 지도 표시 영역 -->
            <div id="map" class="md:col-span-2"></div>

            <!-- 선택 정보 및 계곡 목록 -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold mb-2">선택 지역</h2>
                <p class="mb-4"><span id="selected-region-name" class="font-bold text-blue-600">지역을 선택해주세요.</span></p>
                <h3 class="text-lg font-semibold border-t pt-4">계곡 목록</h3>
                <ul id="valley-list" class="mt-2 space-y-2">
                    <!-- 계곡 목록이 여기에 동적으로 추가됩니다 -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 예시 데이터: 실제로는 서버에서 가져와야 합니다 ---
        const valleyData = {
            "서울특별시": [
                { name: "우이동 계곡", address: "서울 강북구 우이동", lat: 37.6631, lng: 127.0123 },
                { name: "진관사 계곡", address: "서울 은평구 진관동", lat: 37.6369, lng: 126.9412 }
            ],
            "경기도": [
                { name: "송추 계곡", address: "경기 양주시 장흥면", lat: 37.7311, lng: 127.0345 },
                { name: "용추 계곡", address: "경기 가평군 가평읍", lat: 37.8683, lng: 127.5021 },
                { name: "어비 계곡", address: "경기 가평군 설악면", lat: 37.7295, lng: 127.4987 }
            ],
            "강원도": [
                { name: "무릉 계곡", address: "강원 동해시 삼화동", lat: 37.4583, lng: 129.0221 },
                { name: "흥정 계곡", address: "강원 평창군 봉평면", lat: 37.6251, lng: 128.4012 }
            ]
            // ... 다른 지역 데이터
        };

        // --- 2. 행정구역 경계 좌표 데이터 (카카오 예제 활용) ---
        // 이 데이터는 매우 길어서 실제 서비스에서는 별도의 파일로 분리하는 것이 좋습니다.
        // 여기서는 간단한 예시를 위해 일부만 포함합니다.
        let areas = []; // 이 배열은 아래 fetch 로직으로 채워집니다.

        // --- 3. 지도 초기화 및 설정 ---
        const mapContainer = document.getElementById('map');
        const selectedRegionNameSpan = document.getElementById('selected-region-name');
        const valleyList = document.getElementById('valley-list');
        let map;
        let polygons = []; // 지도에 표시된 폴리곤들을 담을 배열
        let markers = []; // 지도에 표시된 마커들을 담을 배열

        kakao.maps.load(() => {
            const mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 서울 중심
                level: 11
            };
            map = new kakao.maps.Map(mapContainer, mapOption);
            
            // 행정구역 데이터(JSON)를 가져와서 폴리곤을 생성합니다.
            fetch('https://raw.githubusercontent.com/southkorea/southkorea-maps/master/kostat/2013/json/skorea-provinces-2013-simple.json')
                .then(response => response.json())
                .then(geojson => {
                    areas = geojson.features.map(feature => ({
                        name: feature.properties.name,
                        path: feature.geometry.coordinates[0].map(coord => new kakao.maps.LatLng(coord[1], coord[0]))
                    }));
                    displayArea(areas);
                });
        });

        // --- 4. 지도에 폴리곤(행정구역) 표시 ---
        function displayArea(areaData) {
            let selectedPolygon = null;

            areaData.forEach((area) => {
                const polygon = new kakao.maps.Polygon({
                    map: map,
                    path: area.path,
                    strokeWeight: 2,
                    strokeColor: '#004c80',
                    strokeOpacity: 0.8,
                    fillColor: '#fff',
                    fillOpacity: 0.7
                });
                polygons.push(polygon);

                // 폴리곤에 마우스 이벤트 리스너 추가
                kakao.maps.event.addListener(polygon, 'mouseover', () => {
                    if (polygon !== selectedPolygon) polygon.setOptions({ fillColor: '#09f' });
                });
                kakao.maps.event.addListener(polygon, 'mouseout', () => {
                    if (polygon !== selectedPolygon) polygon.setOptions({ fillColor: '#fff' });
                });

                // 폴리곤 클릭 이벤트
                kakao.maps.event.addListener(polygon, 'click', () => {
                    // 이전에 선택된 폴리곤이 있다면 원래 스타일로 되돌림
                    if (selectedPolygon) {
                        selectedPolygon.setOptions({ fillColor: '#fff' });
                    }
                    
                    // 현재 폴리곤을 선택된 스타일로 변경
                    polygon.setOptions({ fillColor: '#09f' });
                    selectedPolygon = polygon;

                    // 선택 지역 이름 표시 및 계곡 목록 업데이트
                    updateValleyList(area.name);
                });
            });
        }

        // --- 5. 계곡 목록 업데이트 및 마커 표시 ---
        function updateValleyList(regionName) {
            selectedRegionNameSpan.textContent = regionName;
            valleyList.innerHTML = ''; // 기존 목록 초기화
            removeMarkers(); // 기존 마커 제거

            const valleys = valleyData[regionName];

            if (valleys && valleys.length > 0) {
                valleys.forEach(valley => {
                    // 목록에 아이템 추가
                    const li = document.createElement('li');
                    li.className = 'p-2 rounded valley-list-item';
                    li.textContent = valley.name;
                    li.onclick = () => {
                        const moveLatLon = new kakao.maps.LatLng(valley.lat, valley.lng);
                        map.setLevel(7);
                        map.panTo(moveLatLon);
                    };
                    valleyList.appendChild(li);

                    // 지도에 마커 추가
                    const markerPosition = new kakao.maps.LatLng(valley.lat, valley.lng);
                    const marker = new kakao.maps.Marker({
                        position: markerPosition
                    });
                    marker.setMap(map);
                    markers.push(marker);

                    // 마커에 인포윈도우 추가
                    const infowindow = new kakao.maps.InfoWindow({
                        content: `<div style="padding:5px;font-size:12px;">${valley.name}</div>`
                    });
                    kakao.maps.event.addListener(marker, 'mouseover', () => infowindow.open(map, marker));
                    kakao.maps.event.addListener(marker, 'mouseout', () => infowindow.close());
                });
            } else {
                valleyList.innerHTML = '<li class="text-gray-500">등록된 계곡이 없습니다.</li>';
            }
        }

        // --- 6. 지도 위 마커 제거 함수 ---
        function removeMarkers() {
            for (let i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }
    </script>

</body>
</html>
