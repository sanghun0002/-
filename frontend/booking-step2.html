<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>계곡 예약하기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=18a27bfefd7b461ecd35f7533947ff19&libraries=services,drawing"></script>
  <style>
    #map { width: 100%; height: 600px; border-radius: 0.5rem; }
    .valley-list-item { cursor: pointer; }
    .valley-list-item:hover { background-color: #f0f0f0; }
  </style>
</head>
<body class="bg-gray-100 p-8">

  <div class="container mx-auto max-w-6xl bg-white p-6 rounded-lg shadow-lg">
    <header class="text-center mb-6">
      <h1 class="text-3xl font-bold">계곡 예약하기</h1>
      <p class="text-gray-600">원하는 행정구역과 계곡을 선택하세요.</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- 지도 -->
      <div id="map" class="md:col-span-2"></div>

      <!-- 정보 패널 -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h2 class="text-xl font-semibold mb-2">선택 지역</h2>
        <p class="mb-4"><span id="selected-region-name" class="font-bold text-blue-600">지역을 선택해주세요.</span></p>

        <h3 class="text-lg font-semibold border-t pt-4">계곡 목록</h3>
        <ul id="valley-list" class="mt-2 space-y-2 h-64 overflow-y-auto"></ul>

        <div id="valley-detail" class="hidden mt-6 p-4 border rounded bg-white shadow">
          <h3 class="text-lg font-bold mb-2" id="valley-name"></h3>
          <p class="text-gray-600 mb-4" id="valley-address"></p>
          <button id="reserve-btn" class="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700">예약하기</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 더미 데이터
    const valleyData = {
      "서울특별시": [
        { name: "우이동 계곡", address: "서울 강북구 우이동", lat: 37.6631, lng: 127.0123 },
        { name: "진관사 계곡", address: "서울 은평구 진관동", lat: 37.6369, lng: 126.9412 }
      ],
      "경기도": [
        { name: "송추 계곡", address: "경기 양주시 장흥면", lat: 37.7311, lng: 127.0345 },
        { name: "용추 계곡", address: "경기 가평군 가평읍", lat: 37.8683, lng: 127.5021 }
      ]
    };

    const mapContainer = document.getElementById('map');
    const selectedRegionNameSpan = document.getElementById('selected-region-name');
    const valleyList = document.getElementById('valley-list');
    const valleyDetail = document.getElementById('valley-detail');
    const valleyName = document.getElementById('valley-name');
    const valleyAddress = document.getElementById('valley-address');
    const reserveBtn = document.getElementById('reserve-btn');

    let map, markers = [], selectedValley = null;

    kakao.maps.load(() => {
      map = new kakao.maps.Map(mapContainer, {
        center: new kakao.maps.LatLng(36.5, 127.8),
        level: 12
      });

      map.addControl(new kakao.maps.MapTypeControl(), kakao.maps.ControlPosition.TOPRIGHT);
      map.addControl(new kakao.maps.ZoomControl(), kakao.maps.ControlPosition.RIGHT);

      fetch('https://raw.githubusercontent.com/southkorea/southkorea-maps/master/kostat/2013/json/skorea-provinces-2013-simple.json')
        .then(res => res.json())
        .then(geojson => {
          const areas = geojson.features.map(feature => ({
            name: feature.properties.name,
            path: feature.geometry.coordinates[0].map(coord => new kakao.maps.LatLng(coord[1], coord[0]))
          }));
          drawAreas(areas);
        });
    });

    function drawAreas(areas) {
      areas.forEach(area => {
        const polygon = new kakao.maps.Polygon({
          map: map,
          path: area.path,
          strokeWeight: 2,
          strokeColor: '#004c80',
          fillColor: '#A8D8EA',
          fillOpacity: 0.6
        });

        kakao.maps.event.addListener(polygon, 'click', () => {
          updateValleyList(area.name);
        });
      });
    }

    function updateValleyList(regionName) {
      selectedRegionNameSpan.textContent = regionName;
      valleyList.innerHTML = '';
      clearMarkers();
      valleyDetail.classList.add("hidden");

      const valleys = valleyData[regionName];
      if (!valleys) {
        valleyList.innerHTML = '<li class="text-gray-500">등록된 계곡이 없습니다.</li>';
        return;
      }

      valleys.forEach(valley => {
        const li = document.createElement('li');
        li.className = 'p-2 rounded bg-white shadow valley-list-item';
        li.textContent = valley.name;

        li.onclick = () => showValley(valley);
        valleyList.appendChild(li);

        const marker = new kakao.maps.Mar
